<div class="order-detail">

  <app-breadcrumbs [items]="breadcrumbs"></app-breadcrumbs>

  <!-- Header section -->
  <header class="order-detail__header">

    <button class="order-detail__back-btn" (click)="goBack()">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
        <path d="M8.00001 12.6668L3.33334 8.00016M3.33334 8.00016L8.00001 3.3335M3.33334 8.00016H12.6667" stroke="#232323" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>

    <div class="order-detail__title-container">
      <h1 class="order-detail__title">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M13.3333 13.3335L15 15.0002L18.3333 11.6668M17.5 8.33341V6.66675C17.4997 6.37448 17.4225 6.08742 17.2763 5.83438C17.13 5.58134 16.9198 5.37122 16.6667 5.22508L10.8333 1.89175C10.58 1.74547 10.2926 1.66846 10 1.66846C9.70744 1.66846 9.42003 1.74547 9.16667 1.89175L3.33333 5.22508C3.08022 5.37122 2.86998 5.58134 2.72372 5.83438C2.57745 6.08742 2.5003 6.37448 2.5 6.66675V13.3334C2.5003 13.6257 2.57745 13.9127 2.72372 14.1658C2.86998 14.4188 3.08022 14.6289 3.33333 14.7751L9.16667 18.1084C9.42003 18.2547 9.70744 18.3317 10 18.3317C10.2926 18.3317 10.58 18.2547 10.8333 18.1084L12.5 17.1584M6.25 3.55851L13.75 7.85018M2.7417 5.8335L10 10.0002M10 10.0002L17.2584 5.8335M10 10.0002L10 18.3335" stroke="#71717A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Inquiry ID: {{ inquiryId }}
      </h1>

      <div class="order-detail__badges">
        <span class="order-detail__badge order-detail__badge--shop">{{ type }}</span>
        <span class="order-detail__badge order-detail__badge--pending">{{ status }}</span>
        <span class="order-detail__badge order-detail__badge--unfulfilled">{{ fulfillmentStatus }}</span>
      </div>
    </div>

    <div class="order-detail__actions">
      <button class="order-detail__action-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M12 3.3335L10.3906 1.72416C10.1406 1.4741 9.80155 1.33357 9.44796 1.3335H3.99996C3.64634 1.3335 3.3072 1.47397 3.05715 1.72402C2.8071 1.97407 2.66663 2.31321 2.66663 2.66683V13.3335C2.66663 13.6871 2.8071 14.0263 3.05715 14.2763C3.3072 14.5264 3.64634 14.6668 3.99996 14.6668H12C12.3536 14.6668 12.6927 14.5264 12.9428 14.2763C13.1928 14.0263 13.3333 13.6871 13.3333 13.3335M5.33329 12.0002H5.99996M14.2519 8.41743C14.5175 8.15186 14.6667 7.79167 14.6667 7.4161C14.6667 7.04053 14.5175 6.68034 14.2519 6.41477C13.9864 6.1492 13.6262 6 13.2506 6C12.875 6 12.5148 6.1492 12.2493 6.41477L9.57594 9.08943C9.41744 9.24785 9.30142 9.44366 9.23861 9.65877L8.68061 11.5721C8.66388 11.6295 8.66288 11.6903 8.67771 11.7482C8.69254 11.806 8.72265 11.8589 8.76491 11.9011C8.80716 11.9434 8.86 11.9735 8.91788 11.9883C8.97577 12.0032 9.03658 12.0022 9.09394 11.9854L11.0073 11.4274C11.2224 11.3646 11.4182 11.2486 11.5766 11.0901L14.2519 8.41743Z" stroke="#232323" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Edit
      </button>

      <button class="order-detail__action-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M14 10V12.6667C14 13.0203 13.8595 13.3594 13.6095 13.6095C13.3594 13.8595 13.0203 14 12.6667 14H3.33333C2.97971 14 2.64057 13.8595 2.39052 13.6095C2.14048 13.3594 2 13.0203 2 12.6667V10M4.66667 6.66667L8 10M8 10L11.3333 6.66667M8 10V2" stroke="#232323" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Export
      </button>

      <button class="order-detail__action-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
          <g clip-path="url(#clip0_666_26455)">
            <path d="M4.00004 12.0002H2.66671C2.31309 12.0002 1.97395 11.8597 1.7239 11.6096C1.47385 11.3596 1.33337 11.0205 1.33337 10.6668V7.3335C1.33337 6.97987 1.47385 6.64074 1.7239 6.39069C1.97395 6.14064 2.31309 6.00016 2.66671 6.00016H13.3334C13.687 6.00016 14.0261 6.14064 14.2762 6.39069C14.5262 6.64074 14.6667 6.97987 14.6667 7.3335V10.6668C14.6667 11.0205 14.5262 11.3596 14.2762 11.6096C14.0261 11.8597 13.687 12.0002 13.3334 12.0002H12M4.00004 6.00016V2.00016C4.00004 1.82335 4.07028 1.65378 4.1953 1.52876C4.32033 1.40373 4.4899 1.3335 4.66671 1.3335H11.3334C11.5102 1.3335 11.6798 1.40373 11.8048 1.52876C11.9298 1.65378 12 1.82335 12 2.00016V6.00016M4.66671 9.3335H11.3334C11.7016 9.3335 12 9.63197 12 10.0002V14.0002C12 14.3684 11.7016 14.6668 11.3334 14.6668H4.66671C4.29852 14.6668 4.00004 14.3684 4.00004 14.0002V10.0002C4.00004 9.63197 4.29852 9.3335 4.66671 9.3335Z" stroke="#232323" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
          </g>
          <defs>
            <clipPath id="clip0_666_26455">
              <rect width="16" height="16" fill="white"/>
            </clipPath>
          </defs>
        </svg>
        Print
      </button>
    </div>
  </header>

  <div class="order-detail__body">
    <!-- Meta info section -->
    <div class="order-detail__meta">
      <div class="order-detail__reference">
        <span class="order-detail__meta-label">Internal reference number:</span>
        <span class="order-detail__meta-value">{{ internalReference }}</span>
      </div>
      <div class="order-detail__date">
        <span class="order-detail__meta-label">Date created:</span>
        <span class="order-detail__meta-value">{{ dateCreated }}</span>
      </div>
      <div class="order-detail__parts">
        <span class="order-detail__meta-label">Parts ordered:</span>
        <span class="order-detail__meta-value">{{ partsOrdered }}</span>
      </div>
    </div>

    <!-- Products section -->
    <section class="order-detail__section">
      <div class="order-detail__section-header">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
          <g clip-path="url(#clip0_373_43668)">
            <path d="M4.58332 7.08317L7.49999 9.99984L4.58332 12.9165L1.66666 9.99984L4.58332 7.08317Z" stroke="#71717A" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9.99999 1.6665L12.9167 4.58317L9.99999 7.49984L7.08332 4.58317L9.99999 1.6665Z" stroke="#71717A" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M15.4167 7.08317L18.3333 9.99984L15.4167 12.9165L12.5 9.99984L15.4167 7.08317Z" stroke="#71717A" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9.99999 12.4998L12.9167 15.4165L9.99999 18.3332L7.08332 15.4165L9.99999 12.4998Z" stroke="#71717A" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
          </g>
          <defs>
            <clipPath id="clip0_373_43668">
              <rect width="20" height="20" fill="white"/>
            </clipPath>
          </defs>
        </svg>
        <h2 class="order-detail__section-title">Products ordered</h2>
      </div>

      <!-- Machines with products -->
      <div class="order-detail__machines">
        <!-- Loop through machines -->
        <div class="order-detail__machine" *ngFor="let machine of machines">
          <div class="order-detail__machine-header" (click)="toggleMachine(machine)">
            <div class="order-detail__machine-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M9.16667 7.5H12.5C12.942 7.5 13.366 7.3244 13.6785 7.01184C13.9911 6.69928 14.1667 6.27536 14.1667 5.83333V2.5M9.16667 7.5C9.16667 8.42047 8.42047 9.16667 7.5 9.16667C6.57953 9.16667 5.83333 8.42047 5.83333 7.5C5.83333 6.57953 6.57953 5.83333 7.5 5.83333C8.42047 5.83333 9.16667 6.57953 9.16667 7.5ZM5.83333 17.5V14.1667C5.83333 13.7246 6.00893 13.3007 6.32149 12.9882C6.63405 12.6756 7.05797 12.5 7.5 12.5H10.8333M10.8333 12.5C10.8333 13.4205 11.5795 14.1667 12.5 14.1667C13.4205 14.1667 14.1667 13.4205 14.1667 12.5C14.1667 11.5795 13.4205 10.8333 12.5 10.8333C11.5795 10.8333 10.8333 11.5795 10.8333 12.5ZM4.16667 2.5H15.8333C16.7538 2.5 17.5 3.24619 17.5 4.16667V15.8333C17.5 16.7538 16.7538 17.5 15.8333 17.5H4.16667C3.24619 17.5 2.5 16.7538 2.5 15.8333V4.16667C2.5 3.24619 3.24619 2.5 4.16667 2.5Z" stroke="#232323" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <span class="order-detail__machine-name">{{ machine.name }}</span>
            <button class="order-detail__machine-toggle" [class.order-detail__machine-toggle--open]="machine.isOpen">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M12 10L8 6L4 10" stroke="#232323" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>

          <!-- Products table (shown when machine is open) -->
          <div class="order-detail__machine-content" *ngIf="machine.isOpen">
            <table class="order-detail__products-table">
              <thead>
              <tr>
                <th>Part no.</th>
                <th>Product name</th>
                <th>Weight</th>
                <th>Quantity</th>
                <th>Unit price</th>
                <th>Discount</th>
                <th>Price</th>
              </tr>
              </thead>
              <tbody>
              <tr *ngFor="let product of machine.products">
                <td>{{ product.partNo }}</td>
                <td>{{ product.name }}</td>
                <td>{{ product.weight }}</td>
                <td>{{ product.quantity }}</td>
                <td>€ {{ product.unitPrice | number:'1.2-2' }}</td>
                <td>{{ product.discount }}</td>
                <td>€ {{ product.price | number:'1.2-2' }}</td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Totals -->
      <div class="order-detail__totals">
        <div class="order-detail__total-row">
          <span class="order-detail__total-label">Total price</span>
          <span class="order-detail__total-value">€ {{ totalPrice | number:'1.2-2' }}</span>
        </div>
        <div class="order-detail__total-row order-detail__total-row--highlighted">
          <span class="order-detail__total-label">Amount to pay</span>
          <span class="order-detail__total-value">€ {{ amountToPay | number:'1.2-2' }}</span>
        </div>
      </div>
    </section>

    <!-- Log messages section -->
    <section class="order-detail__section">
      <div class="order-detail__section-header">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M13.3333 13.333L15 14.9997L18.3333 11.6663M17.5 8.33293V6.66626C17.4997 6.37399 17.4225 6.08693 17.2763 5.8339C17.13 5.58086 16.9198 5.37073 16.6667 5.22459L10.8333 1.89126C10.58 1.74498 10.2926 1.66797 10 1.66797C9.70744 1.66797 9.42003 1.74498 9.16667 1.89126L3.33333 5.22459C3.08022 5.37073 2.86998 5.58086 2.72372 5.8339C2.57745 6.08693 2.5003 6.37399 2.5 6.66626V13.3329C2.5003 13.6252 2.57745 13.9123 2.72372 14.1653C2.86998 14.4183 3.08022 14.6285 3.33333 14.7746L9.16667 18.1079C9.42003 18.2542 9.70744 18.3312 10 18.3312C10.2926 18.3312 10.58 18.2542 10.8333 18.1079L12.5 17.1579M6.25 3.55802L13.75 7.84969M2.7417 5.83301L10 9.99967M10 9.99967L17.2584 5.83301M10 9.99967L10 18.333" stroke="#71717A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <h2 class="order-detail__section-title">Log messages</h2>
      </div>

      <div class="order-detail__log">
        <div class="order-detail__log-entry" *ngFor="let log of logMessages">
          <div class="order-detail__log-badge-container">
            <span class="order-detail__log-type" [ngClass]="getLogTypeBadgeClass(log.type)">{{ log.type }}</span>
          </div>
          <div class="order-detail__log-date">{{ log.date }} {{ log.time }}</div>
          <div class="order-detail__log-user">{{ log.user }}</div>
          <div class="order-detail__log-message" [ngClass]="{'order-detail__log-message--highlight': log.message.includes('completed')}">{{ log.message }}</div>
        </div>
      </div>
    </section>
  </div>
</div>
