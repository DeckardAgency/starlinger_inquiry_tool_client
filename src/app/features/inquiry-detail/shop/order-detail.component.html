<div class="order-detail">

  <app-breadcrumbs [items]="breadcrumbs"></app-breadcrumbs>

  <!-- Header section -->
  <header class="order-detail__header">

    <div class="order-detail__header-top">
      <button class="order-detail__back-btn" (click)="goBack()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M8.00001 12.6668L3.33334 8.00016M3.33334 8.00016L8.00001 3.3335M3.33334 8.00016H12.6667" stroke="#232323" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>

      <div class="order-detail__title-container">
        <h1 class="order-detail__title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M13.3333 13.3335L15 15.0002L18.3333 11.6668M17.5 8.33341V6.66675C17.4997 6.37448 17.4225 6.08742 17.2763 5.83438C17.13 5.58134 16.9198 5.37122 16.6667 5.22508L10.8333 1.89175C10.58 1.74547 10.2926 1.66846 10 1.66846C9.70744 1.66846 9.42003 1.74547 9.16667 1.89175L3.33333 5.22508C3.08022 5.37122 2.86998 5.58134 2.72372 5.83438C2.57745 6.08742 2.5003 6.37448 2.5 6.66675V13.3334C2.5003 13.6257 2.57745 13.9127 2.72372 14.1658C2.86998 14.4188 3.08022 14.6289 3.33333 14.7751L9.16667 18.1084C9.42003 18.2547 9.70744 18.3317 10 18.3317C10.2926 18.3317 10.58 18.2547 10.8333 18.1084L12.5 17.1584M6.25 3.55851L13.75 7.85018M2.7417 5.8335L10 10.0002M10 10.0002L17.2584 5.8335M10 10.0002L10 18.3335" stroke="#71717A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Inquiry ID: #{{ order?.orderNumber }}
        </h1>
        <div class="order-detail__badges">
          <span class="order-detail__badge order-detail__badge--shop">{{ order?.["@type"] }}</span>
          <span class="order-detail__badge" [ngClass]="getOrderStatusClass(order?.status || '')">{{ order?.status }}</span>
        </div>
      </div>

      <div class="order-detail__actions">
        <button class="order-detail__action-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M12 3.3335L10.3906 1.72416C10.1406 1.4741 9.80155 1.33357 9.44796 1.3335H3.99996C3.64634 1.3335 3.3072 1.47397 3.05715 1.72402C2.8071 1.97407 2.66663 2.31321 2.66663 2.66683V13.3335C2.66663 13.6871 2.8071 14.0263 3.05715 14.2763C3.3072 14.5264 3.64634 14.6668 3.99996 14.6668H12C12.3536 14.6668 12.6927 14.5264 12.9428 14.2763C13.1928 14.0263 13.3333 13.6871 13.3333 13.3335M5.33329 12.0002H5.99996M14.2519 8.41743C14.5175 8.15186 14.6667 7.79167 14.6667 7.4161C14.6667 7.04053 14.5175 6.68034 14.2519 6.41477C13.9864 6.1492 13.6262 6 13.2506 6C12.875 6 12.5148 6.1492 12.2493 6.41477L9.57594 9.08943C9.41744 9.24785 9.30142 9.44366 9.23861 9.65877L8.68061 11.5721C8.66388 11.6295 8.66288 11.6903 8.67771 11.7482C8.69254 11.806 8.72265 11.8589 8.76491 11.9011C8.80716 11.9434 8.86 11.9735 8.91788 11.9883C8.97577 12.0032 9.03658 12.0022 9.09394 11.9854L11.0073 11.4274C11.2224 11.3646 11.4182 11.2486 11.5766 11.0901L14.2519 8.41743Z" stroke="#232323" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Edit
        </button>

        <button class="order-detail__action-btn order-detail__action-btn--export" (click)="exportOrder()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M14 10V12.6667C14 13.0203 13.8595 13.3594 13.6095 13.6095C13.3594 13.8595 13.0203 14 12.6667 14H3.33333C2.97971 14 2.64057 13.8595 2.39052 13.6095C2.14048 13.3594 2 13.0203 2 12.6667V10M4.66667 6.66667L8 10M8 10L11.3333 6.66667M8 10V2" stroke="#232323" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Export
        </button>

        <button class="order-detail__action-btn" (click)="printOrder()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
            <g clip-path="url(#clip0_666_26455)">
              <path d="M4.00004 12.0002H2.66671C2.31309 12.0002 1.97395 11.8597 1.7239 11.6096C1.47385 11.3596 1.33337 11.0205 1.33337 10.6668V7.3335C1.33337 6.97987 1.47385 6.64074 1.7239 6.39069C1.97395 6.14064 2.31309 6.00016 2.66671 6.00016H13.3334C13.687 6.00016 14.0261 6.14064 14.2762 6.39069C14.5262 6.64074 14.6667 6.97987 14.6667 7.3335V10.6668C14.6667 11.0205 14.5262 11.3596 14.2762 11.6096C14.0261 11.8597 13.687 12.0002 13.3334 12.0002H12M4.00004 6.00016V2.00016C4.00004 1.82335 4.07028 1.65378 4.1953 1.52876C4.32033 1.40373 4.4899 1.3335 4.66671 1.3335H11.3334C11.5102 1.3335 11.6798 1.40373 11.8048 1.52876C11.9298 1.65378 12 1.82335 12 2.00016V6.00016M4.66671 9.3335H11.3334C11.7016 9.3335 12 9.63197 12 10.0002V14.0002C12 14.3684 11.7016 14.6668 11.3334 14.6668H4.66671C4.29852 14.6668 4.00004 14.3684 4.00004 14.0002V10.0002C4.00004 9.63197 4.29852 9.3335 4.66671 9.3335Z" stroke="#232323" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
            </g>
            <defs>
              <clipPath id="clip0_666_26455">
                <rect width="16" height="16" fill="white"/>
              </clipPath>
            </defs>
          </svg>
          Print
        </button>
      </div>
    </div>

    <div class="order-detail__header-bottom">
      <div class="order-detail__info-group order-detail__info-group--left">
        <div class="order-detail__info-item">
          <span class="order-detail__info-label">Internal reference number:</span>
          <span class="order-detail__info-value">{{ order?.id }}</span>
        </div>
      </div>

      <div class="order-detail__info-group order-detail__info-group--right">
        <div class="order-detail__info-item">
          <span class="order-detail__info-label">Date created:</span>
          <span class="order-detail__info-value">{{ order?.createdAt | dateFilter:'dd.MM.yyyy @ HH:mm' }}</span>
        </div>
        <div class="order-detail__info-item">
          <span class="order-detail__info-label">Parts ordered:</span>
          <span class="order-detail__info-value">{{ order?.items?.length || 0 }}</span>
        </div>
      </div>
    </div>
  </header>

  <div class="order-detail__content">

    <!-- Display loading state -->
    <div class="order-detail__loading" *ngIf="isLoading">
      <div class="order-detail__spinner"></div>
      <p>Loading order details...</p>
    </div>

    <!-- Display error message if there's an error -->
    <div class="order-detail__error" *ngIf="error && !isLoading">
      <p>{{ error }}</p>
      <button class="order-detail__retry-button" (click)="loadOrderData()">Retry</button>
    </div>

    <!-- Display order details when loaded -->
    <div class="order-detail__details" *ngIf="!isLoading && !error">

      <!-- Products Ordered Section -->
      <div class="order-detail__products-section">
        <h2 class="order-detail__section-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
            <g clip-path="url(#clip0_825_105576)">
              <path d="M4.58332 7.08341L7.49999 10.0001L4.58332 12.9167L1.66666 10.0001L4.58332 7.08341Z" stroke="#71717A" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M9.99999 1.66675L12.9167 4.58341L9.99999 7.50008L7.08332 4.58341L9.99999 1.66675Z" stroke="#71717A" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M15.4167 7.08341L18.3333 10.0001L15.4167 12.9167L12.5 10.0001L15.4167 7.08341Z" stroke="#71717A" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M9.99999 12.5001L12.9167 15.4167L9.99999 18.3334L7.08332 15.4167L9.99999 12.5001Z" stroke="#71717A" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
            </g>
            <defs>
              <clipPath id="clip0_825_105576">
                <rect width="20" height="20" fill="white"/>
              </clipPath>
            </defs>
          </svg>
          Products ordered
        </h2>

        <!-- Products section with real data -->
        <div class="order-detail__products-table" *ngIf="order?.items">
          <table class="order-detail__table">
            <thead>
            <tr>
              <th class="order-detail__table-header">Part no.</th>
              <th class="order-detail__table-header">Product name</th>
              <th class="order-detail__table-header">Weight</th>
              <th class="order-detail__table-header">Quantity</th>
              <th class="order-detail__table-header">Unit price</th>
              <th class="order-detail__table-header">Discount</th>
              <th class="order-detail__table-header">Price</th>
            </tr>
            </thead>
            <tbody>
            <tr class="order-detail__table-row" *ngFor="let item of order?.items">
              <td class="order-detail__table-cell">{{ item.product.partNo }}</td>
              <td class="order-detail__table-cell">{{ item.product.name }}</td>
              <td class="order-detail__table-cell">{{ item.product.weight }}</td>
              <td class="order-detail__table-cell">{{ item.quantity }}</td>
              <td class="order-detail__table-cell">€ {{ item.unitPrice | priceFilterAdvanced }}</td>
              <td class="order-detail__table-cell"></td>
              <td class="order-detail__table-cell">€ {{ item.subtotal | priceFilterAdvanced }}</td>
            </tr>
            </tbody>
          </table>
        </div>

        <!-- Empty state -->
        <div class="order-detail__empty-state" *ngIf="!order?.items">
          <p>No products in this order</p>
        </div>

        <!-- Total section -->
        <div class="order-detail__total-section">
          <div class="order-detail__total-row">
            <span class="order-detail__total-label">Total price</span>
            <span class="order-detail__total-value">€ {{ grandTotal | priceFilterAdvanced }}</span>
          </div>
        </div>
      </div>

      <!-- Log Messages Section -->
      <div class="order-logs" *ngIf="order?.logs">
        <h2 class="order-logs__title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M13.3333 13.3333L15 14.9999L18.3333 11.6666M17.5 8.33317V6.6665C17.4997 6.37423 17.4225 6.08718 17.2763 5.83414C17.13 5.5811 16.9198 5.37097 16.6667 5.22484L10.8333 1.8915C10.58 1.74522 10.2926 1.66821 10 1.66821C9.70744 1.66821 9.42003 1.74522 9.16667 1.8915L3.33333 5.22484C3.08022 5.37097 2.86998 5.5811 2.72372 5.83414C2.57745 6.08718 2.5003 6.37423 2.5 6.6665V13.3332C2.5003 13.6254 2.57745 13.9125 2.72372 14.1655C2.86998 14.4186 3.08022 14.6287 3.33333 14.7748L9.16667 18.1082C9.42003 18.2545 9.70744 18.3315 10 18.3315C10.2926 18.3315 10.58 18.2545 10.8333 18.1082L12.5 17.1582M6.25 3.55827L13.75 7.84993M2.7417 5.83325L10 9.99992M10 9.99992L17.2584 5.83325M10 9.99992L10 18.3333" stroke="#71717A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Log messages
        </h2>

        <div class="order-logs__container">
          <div class="order-logs__item" *ngFor="let log of order?.logs">
            <div class="order-logs__status" [ngClass]="getLogStatusClass(log.newStatus)">{{ log.newStatus }}</div>
            <div class="order-logs__date">{{ log.createdAt | dateFilter:'dd.MM.yyyy @ HH:mm' }}</div>
            <div class="order-logs__user">System</div>
            <div class="order-logs__comment">{{ log.comment }}</div>
          </div>
        </div>
      </div>

    </div>
  </div>

</div>
