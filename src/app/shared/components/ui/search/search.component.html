<div class="search">
  <div class="search__wrapper">
    <span class="search__icon">
      <svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="m18 18-4.075-4.075m1.741-4.758a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0Z" stroke="#FAFAFA" stroke-width="1.667" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </span>
    <input
      #searchInput
      type="text"
      class="search__input"
      [placeholder]="searchPlaceholder"
      [(ngModel)]="searchQuery"
      (input)="search()"
      (keyup.enter)="search()"
    >
    <span class="search__icons-wrapper">
      <span class="search__icon-s" *ngIf="isLoading">
        <!-- Loading spinner -->
        <svg class="search__spinner" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="6" cy="6" r="5" stroke="#FAFAFA" stroke-width="1" fill="none" stroke-dasharray="20" stroke-dashoffset="10">
            <animateTransform attributeName="transform" type="rotate" from="0 6 6" to="360 6 6" dur="1s" repeatCount="indefinite"/>
          </circle>
        </svg>
      </span>
      <span class="search__icon-s" *ngIf="!isLoading">
        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none">
          <path d="M7.5 3V9C7.5 9.29667 7.58797 9.58668 7.7528 9.83336C7.91762 10.08 8.15189 10.2723 8.42598 10.3858C8.70006 10.4994 9.00166 10.5291 9.29264 10.4712C9.58361 10.4133 9.85088 10.2704 10.0607 10.0607C10.2704 9.85088 10.4133 9.58361 10.4712 9.29264C10.5291 9.00166 10.4994 8.70006 10.3858 8.42598C10.2723 8.15189 10.08 7.91762 9.83336 7.7528C9.58668 7.58797 9.29667 7.5 9 7.5H3C2.70333 7.5 2.41332 7.58797 2.16665 7.7528C1.91997 7.91762 1.72771 8.15189 1.61418 8.42598C1.50065 8.70006 1.47094 9.00166 1.52882 9.29264C1.5867 9.58361 1.72956 9.85088 1.93934 10.0607C2.14912 10.2704 2.41639 10.4133 2.70737 10.4712C2.99834 10.5291 3.29994 10.4994 3.57403 10.3858C3.84812 10.2723 4.08238 10.08 4.24721 9.83336C4.41203 9.58668 4.5 9.29667 4.5 9V3C4.5 2.70333 4.41203 2.41332 4.24721 2.16665C4.08238 1.91997 3.84812 1.72771 3.57403 1.61418C3.29994 1.50065 2.99834 1.47094 2.70737 1.52882C2.41639 1.5867 2.14912 1.72956 1.93934 1.93934C1.72956 2.14912 1.5867 2.41639 1.52882 2.70737C1.47094 2.99834 1.50065 3.29994 1.61418 3.57403C1.72771 3.84812 1.91997 4.08238 2.16665 4.24721C2.41332 4.41203 2.70333 4.5 3 4.5H9C9.29667 4.5 9.58668 4.41203 9.83336 4.24721C10.08 4.08238 10.2723 3.84812 10.3858 3.57403C10.4994 3.29994 10.5291 2.99834 10.4712 2.70737C10.4133 2.41639 10.2704 2.14912 10.0607 1.93934C9.85088 1.72956 9.58361 1.5867 9.29264 1.52882C9.00166 1.47094 8.70006 1.50065 8.42598 1.61418C8.15189 1.72771 7.91762 1.91997 7.7528 2.16665C7.58797 2.41332 7.5 2.70333 7.5 3Z" stroke="#FAFAFA" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M7.5 3V9C7.5 9.29667 7.58797 9.58668 7.7528 9.83336C7.91762 10.08 8.15189 10.2723 8.42598 10.3858C8.70006 10.4994 9.00166 10.5291 9.29264 10.4712C9.58361 10.4133 9.85088 10.2704 10.0607 10.0607C10.2704 9.85088 10.4133 9.58361 10.4712 9.29264C10.5291 9.00166 10.4994 8.70006 10.3858 8.42598C10.2723 8.15189 10.08 7.91762 9.83336 7.7528C9.58668 7.58797 9.29667 7.5 9 7.5H3C2.70333 7.5 2.41332 7.58797 2.16665 7.7528C1.91997 7.91762 1.72771 8.15189 1.61418 8.42598C1.50065 8.70006 1.47094 9.00166 1.52882 9.29264C1.5867 9.58361 1.72956 9.85088 1.93934 10.0607C2.14912 10.2704 2.41639 10.4133 2.70737 10.4712C2.99834 10.5291 3.29994 10.4994 3.57403 10.3858C3.84812 10.2723 4.08238 10.08 4.24721 9.83336C4.41203 9.58668 4.5 9.29667 4.5 9V3C4.5 2.70333 4.41203 2.41332 4.24721 2.16665C4.08238 1.91997 3.84812 1.72771 3.57403 1.61418C3.29994 1.50065 2.99834 1.47094 2.70737 1.52882C2.41639 1.5867 2.14912 1.72956 1.93934 1.93934C1.72956 2.14912 1.5867 2.41639 1.52882 2.70737C1.47094 2.99834 1.50065 3.29994 1.61418 3.57403C1.72771 3.84812 1.91997 4.08238 2.16665 4.24721C2.41332 4.41203 2.70333 4.5 3 4.5H9C9.29667 4.5 9.58668 4.41203 9.83336 4.24721C10.08 4.08238 10.2723 3.84812 10.3858 3.57403C10.4994 3.29994 10.5291 2.99834 10.4712 2.70737C10.4133 2.41639 10.2704 2.14912 10.0607 1.93934C9.85088 1.72956 9.58361 1.5867 9.29264 1.52882C9.00166 1.47094 8.70006 1.50065 8.42598 1.61418C8.15189 1.72771 7.91762 1.91997 7.7528 2.16665C7.58797 2.41332 7.5 2.70333 7.5 3Z" stroke="#09090B" stroke-opacity="0.3" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </span>
      <span class="search__icon-s">
        <svg width="8" height="9" viewBox="0 0 8 9" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M0.958807 9V0.272727H2.27557V4.44034H2.3821L6.04261 0.272727H7.70028L4.1804 4.2017L7.71307 9H6.12784L3.30682 5.10085L2.27557 6.28551V9H0.958807Z"
            fill="#FAFAFA"/>
          <path
            d="M0.958807 9V0.272727H2.27557V4.44034H2.3821L6.04261 0.272727H7.70028L4.1804 4.2017L7.71307 9H6.12784L3.30682 5.10085L2.27557 6.28551V9H0.958807Z"
            fill="#09090B" fill-opacity="0.3"/>
        </svg>
      </span>
    </span>
  </div>

  <div class="search__results" *ngIf="showResults">
    <div class="search__results-header">
      <span class="search__results-title">Results</span>
      <div class="search__results-counts">
        <span class="search__count">Machines <span class="search__count-number">{{machineCounts}}</span></span>
        <span class="search__count">Products <span class="search__count-number">{{productCounts}}</span></span>
        <span class="search__count">Orders <span class="search__count-number">{{orderCounts}}</span></span>
      </div>
    </div>

    <div class="search__results-list" *ngIf="searchResults.length > 0">
      <div class="search__result-item"
           *ngFor="let result of searchResults; let i = index"
           [class.search__result-item--active]="isResultActive(i)"
           (click)="selectResult(result)">
        <div class="search__result-content">
          <div class="search__result-title">{{ result.title }}</div>
          <div class="search__result-type">{{ result.description }}</div>
        </div>
        <div class="search__result-badge">
          <span class="search__badge" [ngClass]="getBadgeClass(result.type)">
            {{ result.badge }}
          </span>
        </div>
      </div>
    </div>

    <div class="search__results-empty" *ngIf="searchResults.length === 0 && !isLoading">
      <span class="search__empty-text">No results found for "{{ searchQuery }}"</span>
    </div>

    <div class="search__results-footer">
      <div class="search__navigation-help">
        <span class="search__help-item">↑↓ To Navigate</span>
        <span class="search__help-item">↵ To Select</span>
        <span class="search__help-item">Esc To Exit</span>
      </div>
    </div>
  </div>
</div>
