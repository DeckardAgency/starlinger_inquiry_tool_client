<div class="spreadsheet" [class.spreadsheet--expanded]="isExpanded" (keydown.escape)="onEscapeKey()">
  <!-- Fullscreen Header (only visible in expanded mode) -->
  <div class="spreadsheet__fullscreen-header" *ngIf="isExpanded">
    <h2 class="spreadsheet__fullscreen-title">Starlinger Part Request Template</h2>
    <button class="spreadsheet__close-fullscreen" (click)="toggleFullscreen()" title="Exit fullscreen (ESC)">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"/>
      </svg>
    </button>
  </div>

  <!-- Tab Navigation -->
  <div class="spreadsheet__tabs">
    <button
      class="spreadsheet__tab-button"
      [class.spreadsheet__tab-button--active]="activeTab === 'client'"
      [class.spreadsheet__tab-button--client]="activeTab === 'client'"
      (click)="switchTab('client')">
      Client data
    </button>
    <button
      class="spreadsheet__tab-button"
      [class.spreadsheet__tab-button--active]="activeTab === 'demo'"
      [class.spreadsheet__tab-button--demo]="activeTab === 'demo'"
      (click)="switchTab('demo')">
      Demo example
    </button>
    <!-- Fullscreen Toggle Button -->
    <button class="spreadsheet__fullscreen-btn" (click)="toggleFullscreen()" title="Toggle fullscreen">
      <svg *ngIf="!isExpanded" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
      </svg>
      <svg *ngIf="isExpanded" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"/>
      </svg>
    </button>
  </div>

  <!-- Spreadsheet Table -->
  <div class="spreadsheet__table-container" [class.spreadsheet__table-container--expanded]="isExpanded">
    <table class="spreadsheet__table">
      <thead class="spreadsheet__table-head">
      <tr class="spreadsheet__table-row">
        <th class="spreadsheet__cell spreadsheet__cell--row-header"></th>
        <th class="spreadsheet__cell spreadsheet__cell--column-header">A</th>
        <th class="spreadsheet__cell spreadsheet__cell--column-header">B</th>
        <th class="spreadsheet__cell spreadsheet__cell--column-header">C</th>
      </tr>
      </thead>
      <tbody class="spreadsheet__table-body">
      <!-- Main Header Row -->
      <tr class="spreadsheet__table-row spreadsheet__table-row--header">
        <td class="spreadsheet__cell spreadsheet__cell--row-number">1</td>
        <td class="spreadsheet__cell spreadsheet__cell--main-header" colspan="3">
          Starlinger part request template
        </td>
      </tr>

      <!-- Column Headers Row -->
      <tr class="spreadsheet__table-row spreadsheet__table-row--subheader">
        <td class="spreadsheet__cell spreadsheet__cell--row-number">2</td>
        <td class="spreadsheet__cell spreadsheet__cell--column-title">Piece(s)</td>
        <td class="spreadsheet__cell spreadsheet__cell--column-title">Item</td>
        <td class="spreadsheet__cell spreadsheet__cell--column-title">Name</td>
      </tr>

      <!-- Data Rows -->
      <ng-container *ngFor="let row of getCurrentData(); let i = index">
        <tr class="spreadsheet__table-row spreadsheet__table-row--data">
          <td class="spreadsheet__cell spreadsheet__cell--row-number">{{ i + 3 }}</td>
          <td class="spreadsheet__cell spreadsheet__cell--input">
            <input
              type="text"
              class="spreadsheet__input"
              [(ngModel)]="row.pieces"
              [readonly]="activeTab === 'demo'"
              placeholder=""
              (input)="onDataChange(i)">
          </td>
          <td class="spreadsheet__cell spreadsheet__cell--input">
            <input
              type="text"
              class="spreadsheet__input"
              [(ngModel)]="row.item"
              [readonly]="activeTab === 'demo'"
              placeholder=""
              (input)="onDataChange(i)">
          </td>
          <td class="spreadsheet__cell spreadsheet__cell--input">
            <input
              type="text"
              class="spreadsheet__input"
              [(ngModel)]="row.name"
              [readonly]="activeTab === 'demo'"
              placeholder=""
              (input)="onDataChange(i)">
          </td>
        </tr>
      </ng-container>

      <!-- Empty rows for visual padding if needed (only in demo mode) -->
      <ng-container *ngIf="activeTab === 'demo' && getCurrentData().length < 10">
        <tr *ngFor="let i of [].constructor(10 - getCurrentData().length); let j = index"
            class="spreadsheet__table-row spreadsheet__table-row--empty">
          <td class="spreadsheet__cell spreadsheet__cell--row-number">
            {{ getCurrentData().length + j + 3 }}
          </td>
          <td class="spreadsheet__cell spreadsheet__cell--empty"></td>
          <td class="spreadsheet__cell spreadsheet__cell--empty"></td>
          <td class="spreadsheet__cell spreadsheet__cell--empty"></td>
        </tr>
      </ng-container>
      </tbody>
    </table>
  </div>

  <!-- Status Message -->
  <div
    *ngIf="statusMessage"
    class="spreadsheet__status"
    [class.spreadsheet__status--success]="isSuccess"
    [class.spreadsheet__status--error]="!isSuccess">
    {{ statusMessage }}
  </div>
</div>
